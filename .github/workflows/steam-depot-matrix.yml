name: Wallpaper Engine Workshop Downloader

on:
  workflow_dispatch:

jobs:
  workshop-items:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        workshop: 
          - "431960|1562118779"  # AppID|WorkshopFileID (Wallpaper Engine example)
      # Sequential download (no parallel)

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Pull SteamCMD Docker image
        run: docker pull cm2network/steamcmd

      - name: Parse AppID and WorkshopID
        run: |
          IFS='|' read -r APPID WORKSHOPID <<< "${{ matrix.workshop }}"
          echo "APPID=$APPID" >> $GITHUB_ENV
          echo "WORKSHOPID=$WORKSHOPID" >> $GITHUB_ENV

      - name: Create download folder
        run: mkdir -p ${{ github.workspace }}/workshop_${{ env.WORKSHOPID }}

      - name: Download Workshop item
        run: |
          docker run --rm -v ${{ github.workspace }}/workshop_${{ env.WORKSHOPID }}:/steamcmd/depot cm2network/steamcmd \
          /home/steam/steamcmd.sh +login ruiiixx UzY3R0JUQjgzRDNZ \
          +workshop_download_item ${{ env.APPID }} ${{ env.WORKSHOPID }} validate \
          +quit

      - name: List downloaded files
        run: ls -R ${{ github.workspace }}/workshop_${{ env.WORKSHOPID }}

      - name: Upload as artifact
        uses: actions/upload-artifact@v4
        with:
          name: workshop-${{ env.WORKSHOPID }}
          path: ${{ github.workspace }}/workshop_${{ env.WORKSHOPID }}
